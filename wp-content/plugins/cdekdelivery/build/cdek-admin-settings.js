(()=>{"use strict";var e={20:(e,t,o)=>{var r=o(609),n=Symbol.for("react.element"),c=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,l=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function a(e,t,o){var r,c={},a=null,d=null;for(r in void 0!==o&&(a=""+o),void 0!==t.key&&(a=""+t.key),void 0!==t.ref&&(d=t.ref),t)i.call(t,r)&&!s.hasOwnProperty(r)&&(c[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===c[r]&&(c[r]=t[r]);return{$$typeof:n,type:e,key:a,ref:d,props:c,_owner:l.current}}t.Fragment=c,t.jsx=a,t.jsxs=a},848:(e,t,o)=>{e.exports=o(20)},609:e=>{e.exports=window.React}},t={};function o(r){var n=t[r];if(void 0!==n)return n.exports;var c=t[r]={exports:{}};return e[r](c,c.exports,o),c.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const r=window.jQuery;var n=o.n(r);const c=window.wp.i18n,i=window.lodash,l=window.wp.element,s=window.wc.wcSettings;var a=o(848);const d=({rules:e,onRulesUpdate:t})=>{const o=(o,r)=>{e[r].to=parseInt(o.target.value),e.forEach(((t,o)=>{0!==o&&null!==t.to&&t.to<=e[o-1].to&&(e[o].to=e[o-1].to+1)})),t([...e])},r=(0,l.useCallback)((0,i.debounce)(o,4e3),[e]),n=(o,r)=>{e[r].value=o.target.value,t([...e])},d=(0,l.useCallback)((0,i.debounce)(n,4e3),[e]);return e.map(((i,l)=>(0,a.jsxs)("div",{children:[(0,c.__)("Order price","cdekdelivery")," ",e[l-1]&&(0,a.jsx)(a.Fragment,{children:(0,c.sprintf)((0,c.__)("from %s%s","cdekdelivery"),e[l-1].to,s.CURRENCY.symbol)})," ",i.to&&(0,a.jsxs)(a.Fragment,{children:[(0,c.__)("less or equal","cdekdelivery"),(0,a.jsx)("input",{defaultValue:i.to,min:e[l-1]?e[l-1].to+1:0,type:"number",onBlur:e=>o(e,l),onInput:e=>r(e,l)}),s.CURRENCY.symbol]})," ",1===e.length&&(0,a.jsx)(a.Fragment,{children:(0,c.__)("any","cdekdelivery")}),", ",(0,c.__)("delivery price","cdekdelivery"),(0,a.jsxs)("select",{onChange:o=>((o,r)=>{e[r].type=o.target.value,t([...e])})(o,l),className:"cdek-selector",defaultValue:i.type,children:[(0,a.jsx)("option",{value:"free",children:(0,c.__)("free","cdekdelivery")}),(0,a.jsx)("option",{value:"percentage",children:(0,c.__)("percentage","cdekdelivery")}),(0,a.jsx)("option",{value:"fixed",children:(0,c.__)("fixed on","cdekdelivery")}),(0,a.jsx)("option",{value:"amount",children:(0,c.__)("amount on","cdekdelivery")})]}),"free"!==i.type&&(0,a.jsx)("input",{defaultValue:i.value,type:"number",min:"amount"===i.type?null:0,onBlur:e=>n(e,l),onInput:e=>d(e,l)}),"percentage"===i.type&&(0,a.jsx)(a.Fragment,{children:"%"}),("amount"===i.type||"fixed"===i.type)&&(0,a.jsx)(a.Fragment,{children:s.CURRENCY.symbol}),0!==l&&(0,a.jsx)("span",{className:"button button-link-delete",onClick:()=>(o=>{o===e.length-1&&(e[o-1].to=null),t(e.filter(((e,t)=>t!==o)))})(l),children:"-"})]},i.to+i.value+i.type+l)))},u=({input:e})=>{const[t,o]=(0,l.useState)([]),[r,n]=(0,l.useState)([]),s=(0,l.useCallback)((0,i.debounce)(((t,o)=>{e.val(JSON.stringify({door:t,office:o}))}),300),[]);return(0,l.useEffect)((()=>{s(t,r)}),[t,r]),(0,l.useEffect)((()=>{try{const t=JSON.parse(e.val());o(t.door),n(t.office)}catch(e){o([{to:null,type:"percentage",value:100}]),n([{to:null,type:"percentage",value:100}])}}),[]),(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"cdek-delivery-rules",children:[(0,a.jsxs)("div",{className:"cdek-header",children:[(0,a.jsx)("h4",{children:(0,c.__)("Rules for delivery by courier","cdekdelivery")}),(0,a.jsx)("span",{className:"button",onClick:()=>{t[t.length-1].to=(t[t.length-2]||{to:0}).to+1,o([...t,{to:null,type:"percentage",value:100}])},children:"+"})]}),(0,a.jsx)(d,{rules:t,onRulesUpdate:o}),(0,a.jsxs)("div",{className:"cdek-header",children:[(0,a.jsx)("h4",{children:(0,c.__)("Rules for delivery to pick-up","cdekdelivery")}),(0,a.jsx)("span",{className:"button",onClick:()=>{r[r.length-1].to=(r[r.length-2]||{to:0}).to+1,n([...r,{to:null,type:"percentage",value:100}])},children:"+"})]}),(0,a.jsx)(d,{rules:r,onRulesUpdate:n})]})})},p=window.wp.apiFetch;var _=o.n(p);const v=window.wp.url;(()=>{const e=(0,i.debounce)((e=>_()({url:(0,v.addQueryArgs)(ajaxurl,{action:`${window.cdek.prefix}-cities`,_wpnonce:window.cdek.nonce,q:e})}).then((e=>{0!==e.data.length?(n()(".city-suggest__404").remove(),n()(".city-suggest__item").remove(),e.data.forEach((e=>{n()(".city-suggest").append(n()('<div class="city-suggest__item"></div>').html(e.full_name).on("click",(()=>{n()("input#woocommerce_official_cdek_city").val(e.full_name.split(",",2)[0]),n()("input#woocommerce_official_cdek_city_code").val(e.code),n()(".city-suggest").remove()})))}))):n()(".city-suggest").append('<div class="city-suggest__404">'+(0,c.__)("Nothing found","cdekdelivery")+"</div>")})).catch((()=>{n()(".city-suggest__404").remove(),n()(".city-suggest__item").remove(),n()(".city-suggest").append('<div class="city-suggest__404">'+(0,c.__)("Temporal error, try again","cdekdelivery")+"</div>")})).finally((()=>n()(".city-loader").remove()))),900);n()("input#woocommerce_official_cdek_city").on("input",(function(){n()(".city-suggest").remove(),n()(".city-loader").remove(),n()(this).after('<div class="city-suggest"></div>').after('<span class="city-loader"></span>'),e(this.value)}));const t=n()("input#woocommerce_official_cdek_delivery_price_rules");if(t.length){const e=window.document.createElement("div");if(t.after(e),void 0!==l.createRoot){const o=(0,l.createRoot)(e);void 0!==o&&"function"==typeof o.render?o.render((0,a.jsx)(u,{input:t})):(0,l.render)((0,a.jsx)(u,{input:t}),e)}else(0,l.render)((0,a.jsx)(u,{input:t}),e)}const o=n()("#woocommerce_official_cdek_services_ban_attachment_inspection"),r=n()("#woocommerce_official_cdek_services_trying_on"),s=n()("#woocommerce_official_cdek_services_part_deliv");function d(e,t){e.prop("checked")?(t.prop("checked",!1),t.prop("disabled",!0)):t.prop("disabled",!1)}function p(e,t){e[0].prop("checked")||e[1].prop("checked")?(t.prop("checked",!1),t.prop("disabled",!0)):t.prop("disabled",!1)}d(o,r.add(s)),p([r,s],o),o.change((function(){d(n()(this),r.add(s))})),r.change((function(){p([n()(this),s],o)})),s.change((function(){p([n()(this),r],o)}))})()})();