(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var n in a)e.o(a,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:a[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.i18n,a=window.jQuery;var n=e.n(a);const i=window.wp.apiFetch;var d=e.n(i);const r=window.wp.url;n()(document).ready((()=>{const e=[];let a=null;const i=()=>{null!==a&&URL.revokeObjectURL(a)},l=n()("#official_cdek_order").on("change",".create select",(e=>l.find(`.item[data-id=${e.target.value}]`).attr("aria-hidden","false"))).on("click",".print",(e=>{e.preventDefault(),e.stopPropagation();const t=l.find(".loader");t.attr("aria-disabled","false"),i(),d()({method:"GET",url:(0,r.addQueryArgs)(ajaxurl,{action:`${window.cdek.prefix}-${e.target.dataset.action}`,_wpnonce:window.cdek.nonce,id:e.target.dataset.id})}).then((e=>{if(!e.success)return void alert(e.message);const t=window.atob(e.data),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);a=window.URL.createObjectURL(new Blob([n],{type:"application/pdf"}));const i=window.document.createElement("a");i.target="_blank",i.href=a,window.document.body.appendChild(i),i.click(),i.remove(),window.document.addEventListener("beforeunload",(()=>URL.revokeObjectURL(a)))})).catch((e=>console.error(e))).finally((()=>t.attr("aria-disabled","true")))})).on("click",".create button.package",(a=>{a.preventDefault(),a.stopPropagation();const i=l.find("input[name=length]").val(),d=l.find("input[name=width]").val(),r=l.find("input[name=height]").val();if(isNaN(i)||""===i)return void alert((0,t.__)("Package length not specified","cdekdelivery"));if(isNaN(d)||""===d)return void alert((0,t.__)("Package width not specified","cdekdelivery"));if(isNaN(r)||""===r)return void alert((0,t.__)("Package height not specified","cdekdelivery"));const o={length:parseInt(i),width:parseInt(d),height:parseInt(r),items:l.find(".item[data-id][aria-hidden=false]").map(((e,t)=>({id:parseInt(t.dataset.id),name:n()(t).text(),qty:parseInt(n()(t).find("input[type=number]").val())}))).toArray()};o.length<1?alert((0,t.__)("Package length should be greater 1","cdekdelivery")):o.width<1?alert((0,t.__)("Package width should be greater 1","cdekdelivery")):o.height<1?alert((0,t.__)("Package height should be greater 1","cdekdelivery")):o.items.length<1?alert((0,t.__)("Items not added to package","cdekdelivery")):(e.push(o),l.find(".create .list").append(n()("<p></p>").text((0,t.__)("Package","cdekdelivery")+` №${e.length} (${o.length}х${o.width}х${o.height}):`+o.items.reduce(((e,t)=>e+`${t.name}${t.qty}, `),"").slice(0,-2))),l.find(".create .item[data-id][aria-hidden=false]").each(((e,t)=>{const a=n()(t).find("input[type=number]"),i=a.attr("max")-a.val();0===i?l.find(`.create select option[value=${t.dataset.id}]`).remove():a.attr("max",i)})),l.find(".create select").val(-1),l.find(".create .pack input[type=text]").val(""),l.find(".create .item[data-id][aria-hidden=false]").attr("aria-hidden","true"),1===l.find(".create select option").length&&l.find(".create").attr("aria-invalid","false"))})).on("click",".create button",(t=>{if(!Object.prototype.hasOwnProperty.call(t.target.dataset,"id"))return;t.preventDefault(),t.stopPropagation(),i();const a=l.find(".loader");a.attr("aria-disabled","false"),d()({method:"POST",url:(0,r.addQueryArgs)(ajaxurl,{action:`${window.cdek.prefix}-create`,_wpnonce:window.cdek.nonce,id:t.target.dataset.id}),data:0!==e.length?e:[{length:l.find("input[name=length]").val(),width:l.find("input[name=width]").val(),height:l.find("input[name=height]").val()}],parse:!1}).then((e=>e.text())).then((e=>l.find(".inside").html(e))).catch((e=>console.error(e))).finally((()=>a.attr("aria-disabled","true")))})).on("click",".deletion",(e=>{e.preventDefault(),e.stopPropagation(),i();const t=l.find(".loader");t.attr("aria-disabled","false"),d()({method:"POST",url:(0,r.addQueryArgs)(ajaxurl,{action:`${window.cdek.prefix}-${e.target.dataset.action}`,_wpnonce:window.cdek.nonce,id:e.target.dataset.id}),parse:!1}).then((e=>e.text())).then((e=>l.find(".inside").html(e))).catch((e=>console.error(e))).finally((()=>t.attr("aria-disabled","true")))})).on("click",".toggle",(e=>{const t=e.target.classList.contains("toggle")?e.target.parentElement:e.target.parentElement.parentElement;t.ariaExpanded="true"===t.ariaExpanded?"false":"true"})).on("click",".intake button",(e=>{if(e.preventDefault(),e.stopPropagation(),i(),l.find(".intake input[required]").each(((e,t)=>t.ariaInvalid=""===t.value?"true":"false")),l.find(".intake input[required][aria-invalid=true]").length>0)return;const t=l.find(".loader");t.attr("aria-disabled","false"),d()({method:"POST",url:(0,r.addQueryArgs)(ajaxurl,{action:`${window.cdek.prefix}-intake_create`,_wpnonce:window.cdek.nonce,id:e.target.dataset.id}),data:{date:l.find("input[name=date]").val(),from:l.find("input[name=from]").val(),to:l.find("input[name=to]").val(),desc:l.find("input[name=desc]").val(),comment:l.find("input[name=comment]").val(),weight:parseInt(l.find("input[name=weight]").val()),call:l.find("input[name=call]").is(":checked")},parse:!1}).then((e=>e.text())).then((e=>l.find(".inside").html(e))).catch((e=>console.error(e))).finally((()=>t.attr("aria-disabled","true")))}))}))})();